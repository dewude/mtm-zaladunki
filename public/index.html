<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MTM System Awizacji</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <h1 class="center">ðŸš› MTM System Awizacji - Strona GÅ‚Ã³wna</h1>

  <div class="center">
    <button onclick="location.href='app_worker.html'">ðŸ“¦ Panel Pracownika</button>
    <button onclick="location.href='skaner.html'">ðŸ“· Skaner</button>
  </div>

  <h2>âž• Dodaj nowÄ… awizacjÄ™</h2>
  <input id="nr" placeholder="Numer zamÃ³wienia">
  <input id="data" type="date">
  <input id="info" placeholder="Informacje dodatkowe">
  <button onclick="dodajAwizacje()">Dodaj</button>

  <h2 onclick="toggle('aktywne')" class="link">ðŸ“‹ Aktywne awizacje â–¼</h2>
  <div id="aktywne" class="hidden"></div>

  <h2 onclick="toggle('zakonczone')" class="link">âœ… ZakoÅ„czone awizacje â–¼</h2>
  <div id="zakonczone" class="hidden"></div>

  <script>
    async function dodajAwizacje() {
      const nr = nr.value.trim(), data = document.getElementById("data").value, info = info.value;
      if (!nr || !data) return alert("UzupeÅ‚nij pola");
      const res = await fetch("/api/awizacje", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ nr_zam: nr, data_wyjazdu: data, info }) });
      const j = await res.json();
      if (j.status === "ok") { alert("Dodano awizacjÄ™"); load(); }
    }

    function toggle(id) {
      const el = document.getElementById(id);
      el.classList.toggle("hidden");
      if (!el.classList.contains("hidden")) load();
    }

    async function load() {
      const res = await fetch("/api/awizacje");
      const data = await res.json();
      const a = data.filter(d => d.status === "aktywne");
      const z = data.filter(d => d.status !== "aktywne");

      document.getElementById("aktywne").innerHTML = a.map(aw => `
        <div>
          <b>${aw.nr_zam}</b> (${aw.data_wyjazdu})<br>${aw.info || ""}<br>
          <button onclick="window.open('/api/drukuj_qr/${aw.id}')">QR</button>
          <button onclick="window.open('/api/drukuj_awizacje/${aw.id}')">Drukuj AwizacjÄ™</button>
          <button onclick="usun(${aw.id})">UsuÅ„</button>
        </div>`).join("");

      document.getElementById("zakonczone").innerHTML = z.map(aw => `<div>${aw.nr_zam} - zakoÅ„czone</div>`).join("");
    }

    async function usun(id) {
      if (!confirm("UsunÄ…Ä‡ awizacjÄ™?")) return;
      await fetch("/api/awizacje/" + id, { method: "DELETE" });
      load();
    }

    load();
  </script>
</body>
</html>
